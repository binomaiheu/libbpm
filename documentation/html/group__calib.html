<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libbpm: Calibration routines</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Calibration routines</h1><hr><a name="_details"></a><h2>Detailed Description</h2>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Files</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">file &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bpm__calibration_8h.html">bpm_calibration.h</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">calibration routines <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">file &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibrate_8c.html">calibrate.c</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">file &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__calibration_8c.html">setup_calibration.c</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">EXTERN int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__calib.html#g74c67b78d44415fa79998a240a9f9095">setup_calibration</a> (<a class="el" href="structbpmconf.html">bpmconf_t</a> *cnf, <a class="el" href="structbpmproc.html">bpmproc_t</a> *proc, int npulses, int startpulse, int stoppulse, double angle, double startpos, double endpos, int num_steps, <a class="el" href="structbunchconf.html">bunchconf_t</a> *bunch)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">EXTERN int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__calib.html#ga20fe180b4f39ef6ef739c9df76004a7">calibrate</a> (<a class="el" href="structbpmconf.html">bpmconf_t</a> *bpm, <a class="el" href="structbunchconf.html">bunchconf_t</a> *bunch, <a class="el" href="structbpmproc.html">bpmproc_t</a> *proc, int npulses, <a class="el" href="structbpmcalib.html">bpmcalib_t</a> *cal)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g74c67b78d44415fa79998a240a9f9095"></a><!-- doxytag: member="bpm_calibration.h::setup_calibration" ref="g74c67b78d44415fa79998a240a9f9095" args="(bpmconf_t *cnf, bpmproc_t *proc, int npulses, int startpulse, int stoppulse, double angle, double startpos, double endpos, int num_steps, bunchconf_t *bunch)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXTERN int setup_calibration           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbpmconf.html">bpmconf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbpmproc.html">bpmproc_t</a> *&nbsp;</td>
          <td class="paramname"> <em>proc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npulses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>startpulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stoppulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>startpos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>endpos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_steps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbunchconf.html">bunchconf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>bunch</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This routine basically defines the calibration steps and returns them into the array of beam structures. It needs an array of processed waveform structures, of dimension npulses from a single BPM. From this it determines the corresponding corrector/mover steps and puts them back into the array of beam structures given the bpm configurations.<p>
Startpulse and stoppulse have to be in the first and last calib steps &amp; will need some extensive error checking for e.g. missed calibration steps...<p>
NOTE: This is not definitive yet - more checking, etc. required!<ul>
<li>DDC or FIT?</li><li>Sign errors?</li><li>not robust to missing steps</li></ul>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>proc</em>&nbsp;</td><td>array of processed waveforms for a single bpm, so array of pulses </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cnf</em>&nbsp;</td><td>array of bpm configuration structures </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>npulses</em>&nbsp;</td><td>number of pulses in the calibration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>startpulse</em>&nbsp;</td><td>start of calibration range </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stoppulse</em>&nbsp;</td><td>stop of calibration range </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>angle</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>startpos</em>&nbsp;</td><td>start position of calibration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>endpos</em>&nbsp;</td><td>end position of calibration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num_steps</em>&nbsp;</td><td>number of calibration steps </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bunch</em>&nbsp;</td><td>the returned <a class="el" href="structbunchconf.html">bunchconf</a> array which represents where the beam is supposed to be in each bpm during each calibration step</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>BPM_SUCCESS upon success, BPM_FAILURE upon failure </dd></dl>

<p>Definition at line <a class="el" href="setup__calibration_8c-source.html#l00008">8</a> of file <a class="el" href="setup__calibration_8c-source.html">setup_calibration.c</a>.</p>

<p>References <a class="el" href="bpm__error_8c-source.html#l00009">bpm_error()</a>, and <a class="el" href="bpm__interface_8h-source.html#l00273">bunchconf::bpmposition</a>.</p>

</div>
</div><p>
<a class="anchor" name="ga20fe180b4f39ef6ef739c9df76004a7"></a><!-- doxytag: member="bpm_calibration.h::calibrate" ref="ga20fe180b4f39ef6ef739c9df76004a7" args="(bpmconf_t *bpm, bunchconf_t *bunch, bpmproc_t *proc, int npulses, bpmcalib_t *cal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXTERN int calibrate           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbpmconf.html">bpmconf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>bpm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbunchconf.html">bunchconf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>bunch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbpmproc.html">bpmproc_t</a> *&nbsp;</td>
          <td class="paramname"> <em>proc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npulses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbpmcalib.html">bpmcalib_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Gets the calibration constants from an array of npulses of beam positions and processed waveform structures and returns an updated calibration structure. Note that this routine updates the IQ phase, the position scale and the tilt scale but DOES NOT touch the frequency, decay time or the t0Offset.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bpm</em>&nbsp;</td><td>Bpm structures </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bunch</em>&nbsp;</td><td>An array of bunch structures, one for each pulse, so essentially this corresponds to where we expect the beam to be in each pulse, so representing corrector positions or mover positions. This information should be filled by the routine setup_calibration( ... ) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>proc</em>&nbsp;</td><td>An array of processed waveforms, one for each pulse, which correspond to calculated positions that were calculated using IQ phase = 0 and scales equal to 1. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>npulses</em>&nbsp;</td><td>The number of pulses in the arrays </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>*cal</em>&nbsp;</td><td>The returned calibration structure for the BPM that was calibrated </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>BPM_SUCCESS upon succes, BPM_FAILURE upon failure </dd></dl>

<p>Definition at line <a class="el" href="calibrate_8c-source.html#l00009">9</a> of file <a class="el" href="calibrate_8c-source.html">calibrate.c</a>.</p>

<p>References <a class="el" href="bpm__error_8c-source.html#l00009">bpm_error()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jun 25 17:32:49 2008 for libbpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
